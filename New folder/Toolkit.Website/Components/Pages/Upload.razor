@page "/fileupload"
@using Microsoft.AspNetCore.Components.Forms

<h3>HTML File Input Without JavaScript</h3>

<div>
    <!-- Input สำหรับเลือกไฟล์ -->
    <InputFile OnChange="HandleFileSelected" accept="image/*" class="form-control my-4" />
</div>

@if (uploadedImageDataUrl != null)
{
    <!-- แสดงตัวอย่างรูปภาพ -->
    <h4>Uploaded Image:</h4>
    <img src="@uploadedImageDataUrl" alt="Uploaded Image" style="max-width: 300px; max-height: 300px;" />
}

@code {
    private string? uploadedImageDataUrl;

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;

        // ตรวจสอบว่าเป็นไฟล์รูปภาพ
        if (file != null && file.ContentType.StartsWith("image/"))
        {
            using var stream = file.OpenReadStream(maxAllowedSize: 1024 * 1024 * 10); // ขนาดสูงสุด 10 MB
            using var memoryStream = new MemoryStream();
            await stream.CopyToAsync(memoryStream);

            // แปลงไฟล์รูปภาพเป็น Base64
            var bytes = memoryStream.ToArray();
            uploadedImageDataUrl = $"data:{file.ContentType};base64,{Convert.ToBase64String(bytes)}";
        }
        else
        {
            uploadedImageDataUrl = null; // เคลียร์ค่าหากไม่ใช่ไฟล์รูปภาพ
        }
    }
}
